<nav>
    <script>
        function onClick() {
            const listElements = event.target.parentNode.children;

            for (const element of listElements) {
                if (element.tagName === 'UL') {
                    element.style.height = element.style.height === '0px' ? element.scrollHeight + 'px' : '0px';
                }
            }
        }
    </script>

    <ul class="normal-list">
        {% for site_page in site.pages %}

        {% if site_page.layout == 'module' %}
        {% if site_page.title == page.title %}
        <li class="module-list"><button onclick="onClick()" class="module selected"><a href="{{ site_page.url }}">{{ site_page.title }}</button></a>
        {% else %}
        <li class="module-list"><button onclick="onClick()" class="module"><a href="{{ site_page.url }}">{{ site_page.title }}</button></a>
        {% endif %}
            <ul>
            {% capture module_prefix %}{{ site_page.title | append: '.' }}{% endcapture %}
            {% for subpage in site.pages %}
            {% if site_page.title == subpage.module %}
            {% if page.title == subpage.title %}
            <li><a class="submodule selected" href="{{ subpage.url }}">{{ subpage.title | remove_first: module_prefix }}</a></li>
            {% else %}
            <li><a class="submodule" href="{{ subpage.url }}">{{ subpage.title | remove_first: module_prefix }}</a></li>
            {% endif %}
            {% endif %}

            {% endfor %}
            </ul>
        </li>
        {% endif %}

        {% endfor %}
    </ul>

    <ul class="search-list hidden">
        {% comment %}
        {% for site_page in site.pages %}


        {% if site_page.title | size > 0 %}
        {% if page.title == site_page.title %}
        <li><a class="submodule selected" href="{{ site_page.url }}">{{ site_page.title }}</a></li>
        {% else %}
        <li><a class="submodule" href="{{ site_page.url }}">{{ site_page.title }}</a></li>
        {% endif %}
        {% endif %}

        {% endfor %}
        {% endcomment %}
    </ul>
</nav>

<script>
    (function() {
        const moduleSublists = document.getElementsByClassName('module-list')[0].children;

        for (const element of moduleSublists) {
            if (element.tagName === 'UL' && element.style.height === '') {
                // Give each element a defined height so that they can be collapsed.
                element.style.height = element.scrollHeight + 'px';
            }
        }
    })()
</script>
